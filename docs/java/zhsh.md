## 纵横四海
[[toc]]
### 攻击怪物
::: tip 进入网址时，会有两种情况，1.处于攻击状态，2.正常状态。由于是动态链接，所以需要根据上一个响应体的内容匹配攻击或者怪物链接。
:::

- 处于攻击状态时，先匹配攻击脚本，退出状态
- 正常状态，匹配怪物，进入怪物页以后再匹配攻击
- 保存数据，先 ***存入缓存*** ，再存入数据库
- 获取数据，***先查缓存***，再查数据库
- 过控制boolean对象，***停止*** 攻击
- ***异步方法*** 存mysql，不影响当前线程打怪
  @[code{1-89}](zhsh.java)


### 获取经验
- 先判断是不是处于怪物界面,是就撤退
- 正则匹配，这里是肯定后置 ***(?<=经验:)*** 匹配。
@[code{91-129}](zhsh.java)


### 返回前端
- 先查缓存，有就缓存
- 没有就查数据库
@[code{135-155}](zhsh.java)
### python版本
::: tip python版本，有修理装备的逻辑，和低等级的后续攻击.正则嵌套了很多循环，影响效率。应该有办法优化才对。最后是输出到文件
:::
@[code](zhsh.py)

### 倒叙读文件
#### 通过java读取文件写的接口，倒叙读居然挺麻烦， ReversedLinesFileReader这个类库也没有维护了
@[code](last.java)


## Bug
::: warning  现存bug
:::


### 未知的请求头
- 未知的请求头，怀疑是https请求，但已忽略证书。jdk ***安装证书*** 颇为繁琐

### 多插入一条
- 异步插入数据库的时候，多插入一条。也有可能是 ***循环依赖*** 导致的

### 异常停止重启
- 如果出现服务器异常 ***Unknown***，停止了，如何重启异常

### 服务器重启
- 关于游戏客服端重启，可以再加一条逻辑判断，进入游戏

## 后续任务
- 跑商是否有搞头。没搞头（X）收益太低
